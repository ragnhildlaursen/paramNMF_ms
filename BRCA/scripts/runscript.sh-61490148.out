
R version 4.1.2 (2021-11-01) -- "Bird Hippie"
Copyright (C) 2021 The R Foundation for Statistical Computing
Platform: x86_64-conda-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #rm(list=ls())
> #setwd("~/projects/paramNMF_ms")
> ################################################################
> ## Robustness of Signatures
> ################################################################
> # library(foreach)
> # library(doParallel)
> # library(parallel)
> # 
> # cores=detectCores()
> # cl <- makeCluster(cores[1]-1)
> #library(ggplot2)
> #library(ggpubr)
> source("loadBRCA214models.R")
> 
> MonoRes = resFactors[[1]]
> MixRes = resFactors[[13]]
> DiRes = resFactors[[37]]
> TriRes = resFactors[[45]]
> cat("GKL: Mono-", MonoRes$gkl, " Mix-",MixRes$gkl, " Di-", DiRes$gkl, " Tri-", TriRes$gkl)
GKL: Mono- 31703.19  Mix- 16796.28  Di- 17780.86  Tri- 15408.9>  
> mMono = cosMatch(TriRes$signatures, MonoRes$signatures)$match
> mMix = cosMatch(TriRes$signatures, MixRes$signatures)$match
> mDi = cosMatch(TriRes$signatures, DiRes$signatures)$match
> 
> ##-----------------------------------------------------------------------
> ## Sample a number of mutations from each patient (downsampling)
> ##-----------------------------------------------------------------------
> sampleV <- V
> nG <- dim(V)[1]     # Number of patients (genomes)
> nMtTps <- dim(V)[2] # Number of mutation types
> nMt <- rowSums(V)
> noSig = 8
> 
> nSim <- 10  # 5 if small study. 100 if intermediate. 200 if large.
> init = 100   # number of initialisations
> tol = 1e-8
> 
> # TriRes <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mfull),noSig), tolerance = tol,initial = init)
> # MixRes <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = list(Mfull,Mdi,Mdi,Mmono),tol=tol,initial = init)
> # DiRes <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mdi),noSig),tolerance = tol,initial = init)
> # MonoRes <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mmono),noSig),tolerance = tol,initial = init)
> 
> #save(TriRes,DiRes,MonoRes, file = "FactorsBRCA119.RData")
> #cat("GKL Di:", DiRes$gkl, " with convergence ", DiRes$conv, "\n")
> #cat("GKL Mix:", MixRes$gkl, " with convergence ", MixRes$conv, "\n")
> 
> ResCosineMatTri <- matrix(0,nrow=noSig,ncol=nSim) 
> ResCosineMatMix <- matrix(0,nrow=noSig,ncol=nSim) 
> ResCosineMatDi <- matrix(0,nrow=noSig,ncol=nSim) 
> ResCosineMatMono <- matrix(0,nrow=noSig,ncol=nSim)
> 
> cat("GKL: Mono-", MonoRes$gkl, " Mix-",MixRes$gkl, " Di-", DiRes$gkl, " Tri-", TriRes$gkl)
GKL: Mono- 31703.19  Mix- 16796.28  Di- 17780.86  Tri- 15408.9> #foreach(nsim=1:nSim, .combine=c, .inorder=FALSE,.export = ls(globalenv())) %dopar% {
> for(nsim in 1:nSim){
+   cat(nsim,"out of",nSim,"\n")
+   nSimMt <- rowSums(V) # could potentially downsample
+   #for (i in 1:nG){
+   #  set.seed(NULL)
+   #  sim <- sample( x=1:nMtTps , size=nSimMt[i], replace=TRUE, prob=V[i,])
+   #  sampleV[i,] <- tabulate(sim,nbins=nMtTps)
+   #}
+   
+   # ResultFixTri <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mfull),noSig), tol=tol,initial = init)
+   # ResultFixMix <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = list(Mfull,Mdi,Mdi,Mmono),tol=tol,initial = init)
+   # ResultFixDi <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mdi),noSig),tol=tol,initial = init)
+   # ResultFixMono <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mmono),noSig),tol=tol,initial = init)
+   # cat("GKL Di:", ResultFixDi$gkl, " with convergence ", ResultFixDi$conv, "\n")
+   # cat("GKL Mix:", ResultFixMix$gkl, " with convergence ", ResultFixMix$conv, "\n")
+   
+   #ResultFixTri <- nmfprm(data = sampleV, noSignatures = noSig, designMatrices = rep(list(Mfull),noSig), tol=tol,initial = init)
+   ResultFixMix <- nmfprm(data = sampleV, noSignatures = noSig, designMatrices = list(Mmono,Mmono,Mmono,Mmono,Mfull,Mfull,Mdi,Mdi),tol=tol,initial = init)
+   ResultFixDi <- nmfprm(data = sampleV, noSignatures = noSig, designMatrices = rep(list(Mdi),noSig),tol=tol,initial = init)
+   #ResultFixMono <- nmfprm(data = sampleV, noSignatures = noSig, designMatrices = rep(list(Mmono),noSig),tol=tol,initial = init)
+   # Compare signatures: Cosine similarity for each patient
+   #ResCosineMatTri[,nsim] = cosMatch(TriRes$signatures,ResultFixTri$signatures)$cossim
+   ResCosineMatMix[,nsim] = cosMatch(MixRes$signatures[mMix,],ResultFixMix$signatures)$cossim
+   ResCosineMatDi[,nsim] = cosMatch(DiRes$signatures[mDi,],ResultFixDi$signatures)$cossim
+   #ResCosineMatMono[,nsim] = cosMatch(MonoRes$signatures[mMono,],ResultFixMono$signatures)$cossim
+   
+   #cat("GKL: Mono-", ResultFixMono$gkl, " Mix-",ResultFixMix$gkl, " Di-", ResultFixDi$gkl, " Tri-", ResultFixTri$gkl)
+   cat("GKL: Mix-",ResultFixMix$gkl, " Di-", ResultFixDi$gkl)
+   #save(ResCosineMatTri,ResCosineMatMix, ResCosineMatDi,ResCosineMatMono, file = "SimilaritySignaturesBRCA214sameData2.RData")
+ }
1 out of 10 
Iterations:6449
GKL: Mix- 16721.96  Di- 17504.552 out of 10 
Iterations:9429
GKL: Mix- 16721.64  Di- 17544.93 out of 10 
Iterations:9125
Iterations:6480
GKL: Mix- 16722.3  Di- 17562.524 out of 10 
Iterations:6797
GKL: Mix- 16721.82  Di- 17684.215 out of 10 
GKL: Mix- 17389.38  Di- 17649.516 out of 10 
Iterations:9351
GKL: Mix- 16782.84  Di- 17571.517 out of 10 
Iterations:9991
Iterations:9717
GKL: Mix- 16793.06  Di- 17420.168 out of 10 
Iterations:4905
GKL: Mix- 16729.87  Di- 17590.159 out of 10 
GKL: Mix- 16734.25  Di- 17558.9110 out of 10 
Iterations:5371
GKL: Mix- 16734.2  Di- 17731.24> cat("GKL: Mix-",MixRes$gkl, " Di-", DiRes$gkl)
GKL: Mix- 16796.28  Di- 17780.86> 
