
R version 4.1.2 (2021-11-01) -- "Bird Hippie"
Copyright (C) 2021 The R Foundation for Statistical Computing
Platform: x86_64-conda-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #rm(list=ls())
> #setwd("~/projects/paramNMF_ms")
> ################################################################
> ## Robustness of Signatures
> ################################################################
> # library(foreach)
> # library(doParallel)
> # library(parallel)
> # 
> # cores=detectCores()
> # cl <- makeCluster(cores[1]-1)
> #library(ggplot2)
> #library(ggpubr)
> source("loadBRCA214models.R")
> 
> MonoRes = resFactors[[1]]
> MixRes = resFactors[[13]]
> DiRes = resFactors[[36]]
> TriRes = resFactors[[45]]
> 
> mMono = cosMatch(TriRes$signatures, MonoRes$signatures)$match
> mMix = cosMatch(TriRes$signatures, MixRes$signatures)$match
> mDi = cosMatch(TriRes$signatures, DiRes$signatures)$match
> 
> ##-----------------------------------------------------------------------
> ## Sample a number of mutations from each patient (downsampling)
> ##-----------------------------------------------------------------------
> sampleV <- V
> nG <- dim(V)[1]     # Number of patients (genomes)
> nMtTps <- dim(V)[2] # Number of mutation types
> nMt <- rowSums(V)
> noSig = 8
> 
> nSim <- 50  # 5 if small study. 100 if intermediate. 200 if large.
> init = 50   # number of initialisations
> tol = 1e-6
> 
> # TriRes <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mfull),noSig), tolerance = tol,initial = init)
> # MixRes <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = list(Mfull,Mdi,Mdi,Mmono),tol=tol,initial = init)
> # DiRes <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mdi),noSig),tolerance = tol,initial = init)
> # MonoRes <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mmono),noSig),tolerance = tol,initial = init)
> 
> #save(TriRes,DiRes,MonoRes, file = "FactorsBRCA119.RData")
> #cat("GKL Di:", DiRes$gkl, " with convergence ", DiRes$conv, "\n")
> #cat("GKL Mix:", MixRes$gkl, " with convergence ", MixRes$conv, "\n")
> 
> ResCosineMatTri <- matrix(0,nrow=noSig,ncol=nSim) 
> ResCosineMatMix <- matrix(0,nrow=noSig,ncol=nSim) 
> ResCosineMatDi <- matrix(0,nrow=noSig,ncol=nSim) 
> ResCosineMatMono <- matrix(0,nrow=noSig,ncol=nSim)
> 
> #foreach(nsim=1:nSim, .combine=c, .inorder=FALSE,.export = ls(globalenv())) %dopar% {
> for(nsim in 1:nSim){
+   cat(nsim,"out of",nSim,"\n")
+   nSimMt <- rowSums(V) # could potentially downsample
+   for (i in 1:nG){
+     set.seed(NULL)
+     sim <- sample( x=1:nMtTps , size=nSimMt[i], replace=TRUE, prob=V[i,])
+     sampleV[i,] <- tabulate(sim,nbins=nMtTps)
+   }
+   
+   # ResultFixTri <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mfull),noSig), tol=tol,initial = init)
+   # ResultFixMix <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = list(Mfull,Mdi,Mdi,Mmono),tol=tol,initial = init)
+   # ResultFixDi <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mdi),noSig),tol=tol,initial = init)
+   # ResultFixMono <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mmono),noSig),tol=tol,initial = init)
+   # cat("GKL Di:", ResultFixDi$gkl, " with convergence ", ResultFixDi$conv, "\n")
+   # cat("GKL Mix:", ResultFixMix$gkl, " with convergence ", ResultFixMix$conv, "\n")
+   
+   ResultFixTri <- nmfprm(data = sampleV, noSignatures = noSig, designMatrices = rep(list(Mfull),noSig), tol=tol,initial = init)
+   ResultFixMix <- nmfprm(data = sampleV, noSignatures = noSig, designMatrices = list(Mmono,Mmono,Mmono,Mmono,Mfull,Mfull,Mdi,Mdi),tol=tol,initial = init)
+   ResultFixDi <- nmfprm(data = sampleV, noSignatures = noSig, designMatrices = rep(list(Mdi),noSig),tol=tol,initial = init)
+   ResultFixMono <- nmfprm(data = sampleV, noSignatures = noSig, designMatrices = rep(list(Mmono),noSig),tol=tol,initial = init)
+   # Compare signatures: Cosine similarity for each patient
+   ResCosineMatTri[,nsim] = cosMatch(TriRes$signatures,ResultFixTri$signatures)$cossim
+   ResCosineMatMix[,nsim] = cosMatch(MixRes$signatures[mMix,],ResultFixMix$signatures)$cossim
+   ResCosineMatDi[,nsim] = cosMatch(DiRes$signatures[mDi,],ResultFixDi$signatures)$cossim
+   ResCosineMatMono[,nsim] = cosMatch(MonoRes$signatures[mMono,],ResultFixMono$signatures)$cossim
+   
+   save(ResCosineMatTri,ResCosineMatMix, ResCosineMatDi,ResCosineMatMono, file = "SimilaritySignaturesBRCA214.RData")
+ }
1 out of 50 
Iterations:956Iterations:2070Iterations:2512Iterations:15782 out of 50 
Iterations:1137Iterations:1604Iterations:1723Iterations:9503 out of 50 
Iterations:1083Iterations:1499Iterations:1530Iterations:7854 out of 50 
Iterations:924Iterations:1419Iterations:1662Iterations:13695 out of 50 
Iterations:709Iterations:1476Iterations:1533Iterations:6416 out of 50 
Iterations:835Iterations:1354Iterations:2694Iterations:6327 out of 50 
Iterations:1067Iterations:1339Iterations:1941Iterations:6498 out of 50 
Iterations:854Iterations:1192Iterations:2298Iterations:10999 out of 50 
Iterations:1085Iterations:1979Iterations:1386Iterations:122210 out of 50 
Iterations:825Iterations:4676Iterations:1304Iterations:87411 out of 50 
Iterations:1290Iterations:1310Iterations:4285Iterations:173912 out of 50 
Iterations:848Iterations:2181Iterations:1570Iterations:106413 out of 50 
Iterations:1151Iterations:1261Iterations:1435Iterations:171514 out of 50 
Iterations:1047Iterations:2906Iterations:1597Iterations:181515 out of 50 
Iterations:914Iterations:1713Iterations:2344Iterations:187916 out of 50 
Iterations:1452Iterations:1321Iterations:2605Iterations:118717 out of 50 
Iterations:1592Iterations:2251Iterations:2004Iterations:126418 out of 50 
Iterations:1192Iterations:1846Iterations:4172Iterations:335519 out of 50 
Iterations:1151Iterations:1436Iterations:2157Iterations:149920 out of 50 
Iterations:880Iterations:2009Iterations:1098Iterations:131721 out of 50 
Iterations:1031Iterations:1114Iterations:3064Iterations:101222 out of 50 
Iterations:820Iterations:1720Iterations:1566Iterations:108223 out of 50 
Iterations:1169Iterations:1228Iterations:2338Iterations:127324 out of 50 
Iterations:1421Iterations:2089Iterations:1471Iterations:93525 out of 50 
Iterations:1122Iterations:1790Iterations:1282Iterations:125126 out of 50 
Iterations:1059Iterations:1631Iterations:2869Iterations:169727 out of 50 
Iterations:1216Iterations:1457Iterations:1999Iterations:163928 out of 50 
Iterations:784Iterations:1175Iterations:1695Iterations:80129 out of 50 
Iterations:1256Iterations:1439Iterations:2399Iterations:85030 out of 50 
Iterations:1003Iterations:1660Iterations:1571Iterations:130631 out of 50 
Iterations:1082Iterations:1342Iterations:2296Iterations:175132 out of 50 
Iterations:1130Iterations:2017Iterations:3487Iterations:154633 out of 50 
Iterations:1130Iterations:2026Iterations:2967Iterations:85034 out of 50 
Iterations:741Iterations:1167Iterations:1321Iterations:176535 out of 50 
Iterations:812Iterations:928Iterations:1347Iterations:217436 out of 50 
Iterations:991Iterations:2899Iterations:1986Iterations:71137 out of 50 
Iterations:977Iterations:2996Iterations:2033Iterations:89438 out of 50 
Iterations:1219Iterations:1493Iterations:1768Iterations:66839 out of 50 
Iterations:1119Iterations:1552Iterations:2813Iterations:170940 out of 50 
Iterations:1638Iterations:2104Iterations:1579Iterations:80541 out of 50 
Iterations:1028Iterations:1245Iterations:2001Iterations:65542 out of 50 
Iterations:2209Iterations:3315Iterations:2469Iterations:166743 out of 50 
Iterations:968Iterations:913Iterations:2243Iterations:145544 out of 50 
Iterations:1611Iterations:1151Iterations:1228Iterations:95945 out of 50 
Iterations:1080Iterations:2732Iterations:2379Iterations:59546 out of 50 
Iterations:1343Iterations:2148Iterations:1797Iterations:100147 out of 50 
Iterations:1296Iterations:1287Iterations:1836Iterations:145648 out of 50 
Iterations:975Iterations:1129Iterations:2882Iterations:154149 out of 50 
Iterations:1507Iterations:1483Iterations:1342Iterations:108750 out of 50 
Iterations:1356Iterations:2229Iterations:3345Iterations:997> 
