
R version 4.1.2 (2021-11-01) -- "Bird Hippie"
Copyright (C) 2021 The R Foundation for Statistical Computing
Platform: x86_64-conda-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> rm(list=ls())
> #setwd("C:/Users/au543194/Documents/projects/paramNMF_ms")
> ################################################################
> ## Robustness of Signatures
> ################################################################
> # library(foreach)
> # library(doParallel)
> # library(parallel)
> # 
> # cores=detectCores()
> # cl <- makeCluster(cores[1]-1)
> #library(ggplot2)
> #library(ggpubr)
> source("loadBRCAmodels.R")
> 
> ##-----------------------------------------------------------------------
> ## Sample a number of mutations from each patient (downsampling)
> ##-----------------------------------------------------------------------
> sampleV <- V
> nG <- dim(V)[1]     # Number of patients (genomes)
> nMtTps <- dim(V)[2] # Number of mutation types
> nMt <- rowSums(V)
> noSig = 4
> 
> nSim <- 10  # 5 if small study. 100 if intermediate. 200 if large.
> init = 150   # number of initialisations
> tol = 0.1
> 
> TriRes <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mfull),noSig), tolerance = tol,initial = init)
> MixRes <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = list(Mfull,Mdi,Mdi,Mmono),tol=tol,initial = init)
> DiRes <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mdi),noSig),tolerance = tol,initial = init)
> MonoRes <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mmono),noSig),tolerance = tol,initial = init)
> save(TriRes,MixRes,DiRes,MonoRes, file = "OneResultBRCA.RData")
> cat("GKL Di:", DiRes$gkl, " with convergence ", DiRes$conv, "\n")
GKL Di: 2081.373  with convergence  TRUE 
> cat("GKL Mix:", MixRes$gkl, " with convergence ", MixRes$conv, "\n")
GKL Mix: 1864.068  with convergence  TRUE 
> 
> ResCosineMatTri <- matrix(0,nrow=noSig,ncol=nSim) 
> ResCosineMatMix <- matrix(0,nrow=noSig,ncol=nSim) 
> ResCosineMatDi <- matrix(0,nrow=noSig,ncol=nSim) 
> ResCosineMatMono <- matrix(0,nrow=noSig,ncol=nSim)
> 
> #foreach(nsim=1:nSim, .combine=c, .inorder=FALSE,.export = ls(globalenv())) %dopar% {
> for(nsim in 1:nSim){
+   cat(nsim,"out of",nSim,"\n")
+   nSimMt <- rowSums(V) # could potentially downsample
+   # for (i in 1:nG){
+   #   set.seed(NULL)
+   #   sim <- sample( x=1:nMtTps , size=nSimMt[i], replace=TRUE, prob=V[i,])
+   #   sampleV[i,] <- tabulate(sim,nbins=nMtTps)
+   # }
+   
+   ResultFixTri <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mfull),noSig), tol=tol,initial = init)
+   ResultFixMix <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = list(Mfull,Mdi,Mdi,Mmono),tol=tol,initial = init)
+   ResultFixDi <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mdi),noSig),tol=tol,initial = init)
+   ResultFixMono <- NMFglmSQR(Data = sampleV, NoSignatures = noSig, DesignMatrix = rep(list(Mmono),noSig),tol=tol,initial = init)
+   cat("GKL Di:", ResultFixDi$gkl, " with convergence ", ResultFixDi$conv, "\n")
+   cat("GKL Mix:", ResultFixMix$gkl, " with convergence ", ResultFixMix$conv, "\n")
+   
+   # Compare signatures: Cosine similarity for each patient
+   ResCosineMatTri[,nsim] = cosMatch(TriRes$Signatures,ResultFixTri$Signatures)$cossim
+   ResCosineMatMix[,nsim] = cosMatch(MixRes$Signatures,ResultFixMix$Signatures)$cossim
+   ResCosineMatDi[,nsim] = cosMatch(DiRes$Signatures,ResultFixDi$Signatures)$cossim
+   ResCosineMatMono[,nsim] = cosMatch(MonoRes$Signatures,ResultFixMono$Signatures)$cossim
+   
+   save(ResCosineMatTri,ResCosineMatMix, ResCosineMatDi,ResCosineMatMono, file = "SimilaritySignaturesBRCA.RData")
+ }
1 out of 10 
GKL Di: 2070.258  with convergence  TRUE 
GKL Mix: 1864.256  with convergence  TRUE 
2 out of 10 
GKL Di: 2093.512  with convergence  FALSE 
GKL Mix: 1855.539  with convergence  TRUE 
3 out of 10 
GKL Di: 2070.246  with convergence  FALSE 
GKL Mix: 1864.428  with convergence  TRUE 
4 out of 10 
GKL Di: 2070.246  with convergence  FALSE 
GKL Mix: 1855.539  with convergence  TRUE 
5 out of 10 
GKL Di: 2081.525  with convergence  TRUE 
GKL Mix: 1862.612  with convergence  TRUE 
6 out of 10 
GKL Di: 2059.089  with convergence  TRUE 
GKL Mix: 1862.045  with convergence  TRUE 
7 out of 10 
GKL Di: 2093.512  with convergence  FALSE 
GKL Mix: 1863.681  with convergence  TRUE 
8 out of 10 
GKL Di: 2070.246  with convergence  FALSE 
GKL Mix: 1866.126  with convergence  TRUE 
9 out of 10 
slurmstepd: error: *** JOB 60797948 ON s05n07 CANCELLED AT 2022-02-16T15:56:55 ***
